{"version":3,"file":"code-frame.js","sourceRoot":"","sources":["../../../src/components/code-frame/code-frame.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Prop, State, Watch, Element, Event, EventEmitter } from '@stencil/core';\nimport Prism from 'prismjs';\nimport 'prismjs/components/prism-jsx';\nimport prettier from 'prettier/standalone';\nimport prettierPluginHTML from 'prettier/plugins/html';\nimport { formatSrcDoc, assignLanguage, iframeListeners } from '../../utils/utils';\nimport i18n from './i18n/i18n';\n\n@Component({\n  tag: 'code-frame',\n  styleUrls: ['prism.css', 'code-frame.css'],\n  shadow: true,\n})\nexport class CodeFrame {\n  @Element() el: HTMLElement;\n  private landmarkIframe?: HTMLIFrameElement;\n\n  /* ---------------------------\n   * Props\n   * --------------------------- */\n\n  /*\n   * Source HTML code to be formatted and highlighted\n   */\n  @Prop() source: string;\n\n  /*\n   * Display landmark elements in iframe\n   */\n  @Prop() landmarkDisplay?: boolean = false;\n\n  /*\n   * Enable accessibility tests using axe-core in iframe\n   */\n  @Prop() accessibility?: boolean = false;\n\n  /*\n   * Starting framework for code preview generation\n   */\n  @Prop() framework?: 'html' | 'react' | 'vue' | 'angular' = 'html';\n\n  /* ---------------------------\n   * Events\n   * --------------------------- */\n\n  @Event() statusUpdate!: EventEmitter<Object>;\n\n  /* ---------------------------\n   * State\n   * --------------------------- */\n\n  @State() showCode = true;\n  @State() activeFormat = '';\n  @State() htmlCode = '';\n  @State() reactCode = '';\n  @State() vueCode = '';\n  @State() angularCode = '';\n  @State() copyLabel = 'Copy code';\n  @State() lang = 'en';\n\n  private codeEl?: HTMLElement;\n\n  /* ---------------------------\n   * Watchers\n   * --------------------------- */\n\n  @Watch('source')\n  async onSourceChange() {\n    await this.formatCodePreview();\n\n    if (this.landmarkDisplay && this.landmarkIframe) {\n      this.landmarkIframe.srcdoc = formatSrcDoc(this.source, this.accessibility, this.lang);\n    }\n  }\n\n  @Watch('framework')\n  async onFrameworkChange() {\n    this.activeFormat = this.framework;\n    await this.updateDisplayedCode();\n  }\n\n  /* ---------------------------\n   * Lifecycle\n   * --------------------------- */\n\n  async componentWillLoad() {\n    // Define lang attribute\n    this.lang = assignLanguage(this.el);\n\n    this.copyLabel = i18n[this.lang].copyLabel;\n\n    this.activeFormat = this.framework;\n  }\n\n  componentDidLoad() {\n    this.formatCodePreview();\n\n    if (this.landmarkDisplay && this.landmarkIframe) {\n      this.landmarkIframe.srcdoc = formatSrcDoc(this.source, this.accessibility, this.lang);\n\n      this.landmarkIframe.onload = () => {\n        const intervalId = setInterval(() => {\n          const hydratedComponent = this.landmarkIframe.contentDocument.body.querySelector('.hydrated');\n\n          if (hydratedComponent) {\n            clearInterval(intervalId);\n\n            iframeListeners(this.landmarkIframe!);\n          }\n        }, 100);\n      }\n    }\n  }\n\n  /* ---------------------------\n   * Helpers\n   * --------------------------- */\n\n  /*\n   * Converts HTML code to React JSX code\n   */\n  private convertToReact(html: string) {\n    const react = html.replace(/\"([^\"]*)\"|(\\b[a-z]+(?:-[a-z]+)+\\b)/g, (match, quoted, kebab) => {\n      if (quoted) return `\"${quoted}\"`;\n\n      if (kebab) {\n        return kebab.replace(/-([a-z])/g, (_, char) => char.toUpperCase());\n      }\n\n      return match;\n    });\n\n    const code = react.replace(/<g/g, '<G').replace(/<\\/g/g, '</G');\n    const componentName = code.match(/<\\w+/);\n\n    if (!componentName) return code;\n\n    const importStatement = `import { ${componentName[0].replace('<', '')} } from '@gcds-core/components-react';\\n\\n`;\n\n    return importStatement + code;\n  }\n\n  /*\n  * Converts HTML code to Angular code\n  */\n  private convertToAngular(html: string) {\n    return html.replace(\n      /(\\s|^)([a-zA-Z_:][-a-zA-Z0-9_:]*)=\"(true|false)\"/gi,\n      '$1[$2]=\"$3\"'\n    );\n  }\n\n  /*\n   * Formats the source code and applies syntax highlighting\n   */\n  private async formatCodePreview() {\n    if (!this.source) return;\n\n    const code = await prettier.format(this.source, {\n      parser: 'html',\n      plugins: [prettierPluginHTML],\n      printWidth: 120,\n      htmlWhitespaceSensitivity: 'ignore',\n      singleQuote: true\n    });\n\n    const react = this.convertToReact(code);\n    const angular = this.convertToAngular(code);\n\n    this.htmlCode = Prism.highlight(code, Prism.languages.html, 'html');\n    this.vueCode = Prism.highlight(code, Prism.languages.html, 'html');\n    this.reactCode = Prism.highlight(react, Prism.languages.jsx, 'jsx');\n    this.angularCode = Prism.highlight(angular, Prism.languages.html, 'html');\n\n    this.updateDisplayedCode();\n  }\n\n  /*\n   * Updates the displayed code based on the active format\n   */\n  private updateDisplayedCode() {\n    if (!this.codeEl) return;\n\n    this.codeEl.innerHTML = this.getActiveCode();\n  }\n\n  /*\n  * Retrieves the code corresponding to the active format\n  */\n  private getActiveCode() {\n    switch (this.activeFormat) {\n      case 'react':\n        return this.reactCode;\n      case 'vue':\n        return this.vueCode;\n      case 'angular':\n        return this.angularCode;\n      case 'html':\n      default:\n        return this.htmlCode;\n    }\n  }\n\n  /* ---------------------------\n   * Actions\n   * --------------------------- */\n\n  /*\n   * Handles the format selection change (HTML or React)\n   */\n  private onFormatChange(e: Event) {\n    const value = (e.target as HTMLSelectElement).value;\n    this.activeFormat = value as 'html' | 'react' | 'vue' | 'angular';\n\n    this.updateDisplayedCode();\n\n    setTimeout(() => {\n      this.statusUpdate.emit({ name: value, type: 'framework' });\n    }, 2500);\n  }\n\n  /*\n   * Copies the current code to clipboard\n   */\n  private copyCode() {\n    const code = this.codeEl?.textContent;\n\n    if (!code) return;\n\n    navigator.clipboard.writeText(code);\n\n    this.copyLabel = i18n[this.lang].copiedLabel;\n\n    setTimeout(() => {\n      this.copyLabel = i18n[this.lang].copyLabel;\n    }, 3000);\n  }\n\n  /* ---------------------------\n   * Render\n   * --------------------------- */\n\n  render() {\n    const { lang } = this;\n\n    return (\n      <section class=\"code-frame\" aria-label={i18n[lang].componentPreview}>\n        {/* Code actions bar: Format selection and toggle visibility */}\n        <div class=\"code-actions-bar\">\n          <gcds-select select-id=\"code-format\" label={i18n[lang].selectEnvironment} hide-label name=\"select\" value={this.activeFormat} onChange={e => this.onFormatChange(e)}>\n            <option value=\"html\">HTML</option>\n            <option value=\"react\">React</option>\n            <option value=\"vue\">Vue</option>\n            <option value=\"angular\">Angular</option>\n          </gcds-select>\n          <gcds-button button-role=\"secondary\" onClick={() => (this.showCode = !this.showCode)}>\n            {this.showCode ? i18n[lang].hideLabel : i18n[lang].showLabel}\n          </gcds-button>\n        </div>\n\n        {/* Component preview area */}\n        <div class=\"component-preview\">\n          {this.landmarkDisplay ?\n            <iframe\n              title={i18n[lang].componentExample}\n              ref={element => (this.landmarkIframe = element as HTMLIFrameElement)}\n              style={{ '--component-display-iframe-height': '12rem' }}\n            />\n            :\n            <slot></slot>\n          }\n        </div>\n\n        {/* Code preview area: Displays the formatted code */}\n        <div class={`code-preview${!this.showCode ? ' hidden' : ''}`}>\n          <pre class=\"language-html\">\n            <code ref={el => (this.codeEl = el as HTMLElement)}></code>\n\n            {this.showCode && (\n              <gcds-button button-role=\"secondary\" size=\"small\" onClick={() => this.copyCode()}>\n                {this.copyLabel}\n              </gcds-button>\n            )}\n          </pre>\n        </div>\n      </section>\n    );\n  }\n}\n"]}