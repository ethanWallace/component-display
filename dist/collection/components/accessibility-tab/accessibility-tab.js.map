{"version":3,"file":"accessibility-tab.js","sourceRoot":"","sources":["../../../src/components/accessibility-tab/accessibility-tab.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, h, State, Element, Prop } from '@stencil/core';\nimport axe from 'axe-core';\nimport axeLocaleFr from 'axe-core/locales/fr.json';\n\nimport { assignLanguage, closestElement } from '../../utils/utils';\nimport i18n from './i18n/i18n';\n\n@Component({\n  tag: 'accessibility-tab',\n  styleUrl: 'accessibility-tab.css',\n  shadow: false,\n})\nexport class AccessibilityTab {\n  @Element() el: HTMLElement;\n\n  /* ---------------------------\n   * Props\n   * --------------------------- */\n  @Prop() displayElement!: Element;\n  @Prop() landmarkDisplay?: boolean;\n\n  /* ---------------------------\n   * State\n   * --------------------------- */\n\n  @State() axeResults: axe.AxeResults | null = null;\n  @State() testRunning: boolean = false;\n  @State() lang: string = 'en';\n\n  /* ---------------------------\n   * Actions\n   * --------------------------- */\n\n  private async runA11yTest() {\n    if (this.testRunning) {\n      console.warn('Accessibility test is already running.');\n      return;\n    }\n\n    this.testRunning = true;\n\n    try {\n      const container = this.landmarkDisplay\n        ? closestElement('component-display', this.el).shadowRoot.querySelector('code-frame').shadowRoot.querySelector('iframe').contentWindow.document.body\n        : this.el.querySelector('#test-container');\n\n      if (!this.landmarkDisplay) {\n        container.innerHTML = this.displayElement.outerHTML;\n      }\n\n      setTimeout(async () => {\n        if (this.lang === 'fr') {\n          if (this.landmarkDisplay) {\n            closestElement('component-display', this.el)\n              .shadowRoot.querySelector('code-frame')\n              .shadowRoot.querySelector('iframe')\n              .contentWindow!.axe.configure({ locale: axeLocaleFr });\n          } else {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-expect-error\n            axe.configure({ locale: axeLocaleFr });\n          }\n        }\n\n        // Test on component inside iframe\n        if (this.landmarkDisplay) {\n          this.axeResults = await closestElement('component-display', this.el)\n            .shadowRoot.querySelector('code-frame')\n            .shadowRoot.querySelector('iframe')\n            .contentWindow!.axe.run(container);\n        } else {\n          this.axeResults = await axe.run(container);\n        }\n\n        if (!this.landmarkDisplay) {\n          container.innerHTML = '';\n        }\n      }, 2000);\n    } catch (error) {\n      console.error('Error running accessibility tests:', error);\n      return null;\n    } finally {\n      setTimeout(() => {\n        this.testRunning = false;\n      }, 2000);\n    }\n  }\n\n  /* ---------------------------\n   * Helpers\n   * --------------------------- */\n\n  renderAxeResultsTable() {\n    if (this.axeResults && this.axeResults.violations.length > 0) {\n      return (\n        <table class=\"axe-results-table\">\n          <thead>\n            <tr>\n              <th>{i18n[this.lang].violationID}</th>\n              <th>{i18n[this.lang].description}</th>\n              <th>{i18n[this.lang].affected}</th>\n              <th>{i18n[this.lang].summary}</th>\n            </tr>\n          </thead>\n          <tbody>\n            {this.axeResults.violations.map(violation => (\n              <tr key={violation.id}>\n                <td>{violation.id}</td>\n                <td>{violation.description}</td>\n                <td>\n                  <ul>\n                    {violation.nodes.map((node, index) => (\n                      <li key={index}>\n                        <code>{node.html}</code>\n                      </li>\n                    ))}\n                  </ul>\n                </td>\n                <td>\n                  <ul>\n                    {violation.nodes.map((node, index) => (\n                      <li key={index}>{node.failureSummary}</li>\n                    ))}\n                  </ul>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      );\n    } else if (this.axeResults) {\n      return (\n        <table class=\"axe-results-table\">\n          <thead>\n            <tr>\n              <th>{i18n[this.lang].test}</th>\n              <th>{i18n[this.lang].description}</th>\n            </tr>\n          </thead>\n          <tbody>\n            {this.axeResults.passes.map(pass => (\n              <tr key={pass.id}>\n                <td>{pass.id}</td>\n                <td>{pass.description}</td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      );\n    }\n\n    return null;\n  }\n\n  /* ---------------------------\n   * Lifecycle\n   * --------------------------- */\n\n  async componentWillLoad() {\n    // Define lang attribute\n    this.lang = assignLanguage(this.el);\n  }\n\n  /* ---------------------------\n   * Render\n   * --------------------------- */\n\n  render() {\n    const { lang } = this;\n\n    return (\n      <Host role=\"tabpanel\" tabindex=\"0\">\n        <gcds-button\n          button-role=\"secondary\"\n          disabled={this.testRunning}\n          onClick={async () => {\n            await this.runA11yTest();\n          }}\n        >\n          {this.testRunning ? <span>{i18n[lang].runningTest}</span> : <span>{i18n[lang].runTest}</span>}\n        </gcds-button>\n\n        <p aria-live=\"polite\">\n          {this.axeResults && this.axeResults.violations.length > 0 ? `${this.axeResults.violations.length} ${i18n[lang].issues}` : this.axeResults && i18n[lang].noIssues}\n        </p>\n\n        <div id=\"test-container\"></div>\n\n        {this.renderAxeResultsTable()}\n      </Host>\n    );\n  }\n}\n"]}