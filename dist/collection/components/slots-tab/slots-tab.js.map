{"version":3,"file":"slots-tab.js","sourceRoot":"","sources":["../../../src/components/slots-tab/slots-tab.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, h, Element, Prop, Event, EventEmitter, State } from '@stencil/core';\nimport DOMPurify from 'dompurify';\n\nimport { assignLanguage, SlotType, formatDataLabel } from '../../utils/utils';\nimport i18n from './i18n/i18n';\n\n@Component({\n  tag: 'slots-tab',\n  styleUrl: 'slots-tab.css',\n  shadow: false,\n})\nexport class SlotsTab {\n  @Element() el: HTMLElement;\n\n  private valueChecker: number | null = null;\n  private lastInputValue = {};\n\n  /* ---------------------------\n   * Props\n   * --------------------------- */\n\n  @Prop() slotObject: Array<SlotType>;\n  @Prop() displayElement!: Element;\n  @Prop() slotHistory: Object;\n\n  /* ---------------------------\n   * Events\n   * --------------------------- */\n\n  @Event() slotValueChange!: EventEmitter<Object>;\n  @Event() statusUpdate!: EventEmitter<Object>;\n\n  /* ---------------------------\n   * State\n   * --------------------------- */\n\n  @State() lang: string = 'en';\n  @State() slotErrors: { [k: string]: string } = {};\n  @State() lastInputTimestamp = [];\n\n  /* ---------------------------\n   * Actions\n   * --------------------------- */\n\n  /*\n   * Sanitize and emit slot change event\n   */\n  private emitSlotEvent(e) {\n    const sanitizedValue = DOMPurify.sanitize(e.target.value, {\n      CUSTOM_ELEMENT_HANDLING: {\n        tagNameCheck: /^gcds-/,\n        attributeNameCheck: /.*/,\n        allowCustomizedBuiltInElements: false,\n      },\n      ADD_ATTR: ['slot'],\n    });\n\n    const textarea = e.target as HTMLGcdsTextareaElement;\n    const name = textarea.name;\n\n    // Prevent emitting invalid slot content for slots\n    if (textarea.value.trim() !== '') {\n      // Check if the slot content includes the correct slot attribute\n      if (name !== 'default' && !textarea.value.includes(`slot=\"${name}\"`)) {\n        this.slotErrors = { ...this.slotErrors, [name]: i18n[this.lang].slotMissingAttribute.replaceAll('{name}', name) };\n        return;\n      }\n      if (sanitizedValue !== textarea.value) {\n        this.slotErrors = { ...this.slotErrors, [name]: i18n[this.lang].slotSanitized };\n\n        return;\n      }\n    }\n\n    // clear error for that slot\n    this.slotErrors = { ...this.slotErrors, [name]: '' };\n\n    const eventDetail = {\n      name,\n      value: sanitizedValue,\n    };\n\n    this.slotValueChange.emit(eventDetail);\n  }\n\n  private onFocusStartInterval = (e) => {\n    const element = e.target.shadowRoot.querySelector(`[name=\"${e.target.name}\"]`);\n    const value = element.value;\n    const name = element.name;\n    // Start value checking on input\n    this.valueChecker = window.setInterval(() => {\n      if (Date.now() - 500 >= this.lastInputTimestamp[name]) {\n        if (value !== this.lastInputValue[name] && this.slotErrors[name] === '') {\n          this.statusUpdate.emit({ name: name, type: 'slot' });\n          clearInterval(this.valueChecker);\n        }\n      }\n    }, 1000);\n  };\n\n  private onBlurClearInterval = () => {\n    if (this.valueChecker) {\n      window.clearInterval(this.valueChecker);\n    }\n  };\n\n  /* ---------------------------\n   * Lifecycle\n   * --------------------------- */\n\n  async componentWillLoad() {\n    // Define lang attribute\n    this.lang = assignLanguage(this.el);\n  }\n\n  /* ---------------------------\n   * Render\n   * --------------------------- */\n\n  render() {\n    const { lang } = this;\n\n    return (\n      <Host role=\"tabpanel\" tabindex=\"0\">\n        <table class=\"slots\">\n          <caption>{i18n[lang].caption}</caption>\n          <tr>\n            <th>{i18n[lang].name}</th>\n            <th>{i18n[lang].description}</th>\n            <th>{i18n[lang].control}</th>\n          </tr>\n\n          {this.slotObject.map(slot => {\n            this.lastInputValue = { ...this.lastInputValue, [slot.name]: this.slotHistory[slot.name] };\n            const control = (\n              <gcds-textarea\n                label={slot.name}\n                textareaId={slot.name}\n                name={slot.name}\n                hideLabel\n                value={this.slotHistory[slot.name]}\n                error-message={this.slotErrors[slot.name]}\n                validate-on=\"other\"\n                onChange={e => this.emitSlotEvent(e)}\n                onFocus={e => this.onFocusStartInterval(e)}\n                onBlur={this.onBlurClearInterval}\n                lang={this.lang}\n              ></gcds-textarea>\n            );\n            return (\n              <tr>\n                <td data-label={formatDataLabel(i18n[lang].name, lang)}>{slot.name}</td>\n                <td data-label={formatDataLabel(i18n[lang].description, lang)}>{slot.description}</td>\n                <td>{control}</td>\n              </tr>\n            );\n          })}\n        </table>\n      </Host>\n    );\n  }\n}\n"]}